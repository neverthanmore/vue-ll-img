!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).lazyLoad=t()}(this,function(){"use strict";var e=function(){function e(){babelHelpers.classCallCheck(this,e),this._events={},this._del=[]}return babelHelpers.createClass(e,[{key:"$on",value:function(e,t){this._events[e]||(this._events[e]=[]),this.$has(e,t)||this._events[e].push(t)}},{key:"$once",value:function(e,t){var n=this;this.$on(e,function e(){n._del.push(e),t.apply(n,arguments)})}},{key:"$off",value:function(e,t){var n=this._events[e];if(n&&n.length){var r=n.indexOf(t);return-1<r?n.splice(r,1):void 0}}},{key:"$emit",value:function(t){for(var n=this,e=arguments.length,r=new Array(1<e?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];(this._events[t]||[]).forEach(function(e){return e.call.apply(e,[n].concat(r))}),this._del.forEach(function(e){return n.$off(t,e)}),this._del=[]}},{key:"$has",value:function(e,t){var n=this._events[e];return n&&n.includes(t)}}]),e}();var t=!!("IntersectionObserver"in window&&"IntersectionObserverEntry"in window&&window.IntersectionObserverEntry.prototype.hasOwnProperty("intersectionRatio"))&&(window.IntersectionObserverEntry.prototype.hasOwnProperty("isIntersecting")||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return 0<this.intersectionRatio}}),!0);var i=function(){if("undefined"!=typeof window){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t),window.removeEventListener("test",null,t)}catch(e){}return e}}(),o={on:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]&&arguments[3];e.addEventListener(t,n,i?{passive:!0,capture:r}:r)},off:function(e){for(var t=arguments.length,n=new Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];e.removeEventListener.apply(e,[type].concat(n))}};function r(e,t){if(Array.isArray(e)&&e.length){var n=e.indexOf(t);-1<n&&e.splice(n,1)}}var s={},c=function(){function o(e){var t=e.imgStateSrc,n=e.preLoad,r=e.el,i=e.$parent;babelHelpers.classCallCheck(this,o),this.img=t,this.preLoad=n,this.el=r,this.$parent=i,this.performance={init:Date.now(),start:0,end:0},"dataset"in this.el?this.el.dataset.src=this.img.loaded:this.el.setAttribute("data-src",this.img.loaded),this.render("loading")}return babelHelpers.createClass(o,[{key:"render",value:function(e){this.state=e,this.el.setAttribute("lazy",e),this.el.setAttribute("src",this.img[e])}},{key:"checkInview",value:function(){var e=this.el.getBoundingClientRect(),t=this.preLoad;return e.top<window.innerHeight*t&&0<e.bottom&&e.left<window.innerWidth*t&&0<e.right}},{key:"update",value:function(e){var t=this.img.loaded;this.img=e,t===this.img.loaded&&this.render("loading")}},{key:"load",value:function(){var t=this,e=this.img;if("loaded"===this.state||s[e.loaded])this.render("loaded");else{var n=new Image;n.src=e.src,this.performance.start=Date.now(),n.onload=function(){t.render("loaded"),s[e.src]=1,t.performance.end=Date.now()},n.onerror=function(e){t.render("error")}}}},{key:"destory",value:function(){this.img=null,this.preLoad=null,this.el=null,this.$parent=null}}]),o}();function v(e){return"".concat(n(e,"overflow")).concat(n(e,"overflow-x")).concat(v(e))}function n(e,t){return window.getComputedStyle?getComputedStyle(e,null).getPropertyValue(t):e.style[t]}var f="undefined"!=typeof window,p={rootMargin:"0px",threshold:0},y=["scroll","wheel","mousewheel","resize","animationend","transitionend","touchmove"],b="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",a=Object.prototype.toString,l=function(e){function h(e,t){var n,i,o,s,a,r=t.throttleWait,l=t.observerOptions,u=t.preLoad,d=t.error,c=t.loading,v=t.listenEventTypes;return babelHelpers.classCallCheck(this,h),(n=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(h).call(this))).listenerQueue=[],n.scrollerElementQueue=[],n.vue=e,n.silent=e.config.silent,n._observer=null,n.options={preLoad:u||1.3,loading:c||b,error:d||b,observerOptions:l||p,listenEventTypes:v||y},n._events.loaded=[],n.lazyEventHandle=(i=n._lazyEventHandle.bind(babelHelpers.assertThisInitialized(n)),o=r||200,s=null,a=0,function(){if(!s){var e=Date.now()-a,t=this,n=arguments,r=function(){a=Date.now(),s=null,i.apply(t,n)};o<=e?r():s=setTimeout(r,o)}}),n.initObserverMode(),n}return babelHelpers.inherits(h,e),babelHelpers.createClass(h,[{key:"initObserverMode",value:function(){t&&(this._observer=new IntersectionObserver(this._observerHandler.bind(this),this.options.observerOptions))}},{key:"_observerHandler",value:function(e){var n=this;e.forEach(function(t){if(t.isIntersecting){var e=n.listenerQueue.find(function(e){return e.el===t.target});if("loaded"===e.state)return n._observer.unobserve(e.el);e.load()}})}},{key:"_lazyEventHandle",value:function(){var t=this,n=[];this.listenerQueue.forEach(function(e){return"loading"!==e.state?n.push(e):e.checkInView()?e.load():void 0}),n.forEach(function(e){return r(t.listenerQueue,e)})}},{key:"addListener",value:function(i,o,s){var a=this;if(this.elInQueue(i))this.updateListener(i,o,s);else{var e=this.valueFormatter(o.value),l=e.loaded,u=e.loading,d=e.error;this.vue.$nextTick(function(){var e,t,n=o.arg;n&&(e=s.context.$refs[n],t=document.getElementById(n),e=e?e.$el:t||function(e){if("undefined"!=typeof window){if(e instanceof HTMLElement)return window;for(var t=e;t&&t!==document.body&&t!==document.documentElement&&t.parentNode;){if(/(overflow|auto)/.test(v(t)))return t;t=t.parentNode}return window}}(i));var r=new c({imgStateSrc:{loaded:l,loading:u,error:d},preLoad:a.options.preLoad,el:i,$parent:e});a.listenerQueue.push(r),a._observer&&a._observer.observe(i),f&&a.addToScrollerQueue([window,e]),a.vue.$nextTick(a.lazyEventHandle.bind(a))})}}},{key:"updateListener",value:function(t,e,n){var r=this,i=this.valueFormatter(e.value),o=i.loaded,s=i.loading,a=i.error,l=find(this.listenerQueue,function(e){return e.el===t});l?(l.update({loaded:o,loading:s,error:a}),this._observer&&(this._observer.unobserve(t),this._observer.observe(t)),this.vue.nextTick(function(){return r.lazyLoadHandler()})):this.addListener(t,e,n)}},{key:"removeListener",value:function(t){if(t){this._observer&&this._observer.unobserve(t);var e=find(this.listenerQueue,function(e){return e.el===t});e&&(this._removeListenerTarget(e.$parent),this._removeListenerTarget(window),r(this.listenerQueue,e)&&e.destroy())}}},{key:"_removeListenerTarget",value:function(n){var r=this;this.scrollerElementQueue.forEach(function(e,t){e.el===n&&(e.childrenCount--,e.childrenCount||(r.bindLazyEvent(e.el,!1),r.scrollerElementQueue.splice(t,1),e=null))})}},{key:"addToScrollerQueue",value:function(e){var n=this;e&&(Array.isArray(e)?e:[e]).forEach(function(e){var t=n.findTarget(e);t?t.childCount++:(n.scrollerElementQueue.push({el:e,childCount:1}),!n._observer&&n.bindLazyEvent(e))})}},{key:"bindLazyEvent",value:function(t,n){var r=this;this.options.listenEventTypes.forEach(function(e){return o[n?"on":"off"](t,e,r.lazyEventHandle)})}},{key:"elInQueue",value:function(t){return this.listenerQueue.some(function(e){return e.el===t})}},{key:"findTarget",value:function(t){return this.scrollerElementQueue.find(function(e){return e.el===t})}},{key:"valueFormatter",value:function(e){var t={loaded:"",loading:"",error:""},n=this.options,r=n.loading,i=n.error;return"[object Object]"===a.call(e)?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];!(t.some(function(e){return"[object Object]"!==Object.prototype.toString.call(e)})||t.length<2)&&t.reduce(function(e,t){for(var n=Object.entries(t),r=0;r<n.length;r++){var i=babelHelpers.slicedToArray(n[r],2),o=i[0],s=i[1];s&&e.hasOwnProperty(o)&&(e[o]=s)}return e})}(t,{loading:r,error:i},e):Object.assign(t,{loading:r,error:i,loaded:e}),t}}]),h}(e);return{install:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(2===e.version.slice(0,1)||e.config.silent){var n=new l(e,t);e.prototype.$lazyLoad=n,e.directive("lazy-img",{bind:n.addListener.bind(n),update:n.updateListener.bind(n),componentUpdated:n.lazyEventHandle.bind(n),unbind:n.removeListener.bind(n)})}else console.error("【vue-lazyLoad】The plugin only support Vue2.x, please change your vuejs version!")}}});
